{% extends "base.html" %}

{% block title %}Home{% endblock %}

{% block content %}
<div class="dashboard-header" data-aos="fade-down">
  <h1 class="welcome-text">Welcome back, {{ user }}!</h1>
  <p class="text-muted">Access your services and monitoring tools</p>
</div>

<div class="dashboard-grid">
  <!-- Media Management Section -->
  <section class="section">
    <div class="section-header">
      <h2><i class="fas fa-film"></i> Media Management</h2>
    </div>
    <div class="service-grid">
      <!-- Default Media Services -->
      <div class="service-card">
        <a href="https://drewwilliams.biz/sonarr" target="_blank" class="service-link">
          <div class="service-icon">
            <i class="fas fa-tv"></i>
          </div>
          <h3>Sonarr</h3>
          <p>TV Show Management</p>
        </a>
      </div>

      <div class="service-card">
        <a href="https://drewwilliams.biz/radarr" target="_blank" class="service-link">
          <div class="service-icon">
            <i class="fas fa-film"></i>
          </div>
          <h3>Radarr</h3>
          <p>Movie Management</p>
        </a>
      </div>

      <div class="service-card">
        <a href="http://drewwilliams.biz/nzbget" target="_blank" class="service-link">
          <div class="service-icon">
            <i class="fas fa-download"></i>
          </div>
          <h3>NZBGet</h3>
          <p>Download Management</p>
        </a>
      </div>

      <!-- Custom Media Services -->
      {% for service in media_services %}
        <div class="service-card">
          <!-- Edit button -->
          <a href="{{ url_for('edit_service', service_id=service.id) }}" class="btn-edit-service" title="Edit service">
            <i class="fas fa-cog"></i>
          </a>
          
          <!-- Delete button -->
          <form method="POST" action="{{ url_for('delete_service', service_id=service.id) }}"
                class="delete-service" onsubmit="return confirm('Delete this service?');">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <button type="submit" class="btn-delete-service" title="Delete service">
              <i class="fas fa-trash-alt"></i>
            </button>
          </form>
          
          <!-- Service link wrapper -->
          <a href="{{ service.url }}" target="_blank" class="service-link">
            <div class="service-icon">
              <i class="fas {{ service.icon }}"></i>
            </div>
            <h3>{{ service.name }}</h3>
            <p>{{ service.description }}</p>
          </a>
        </div>
      {% endfor %}

      <!-- Add service card -->
      <a href="{{ url_for('add_service') }}" class="service-card add-card">
        <div class="service-icon">
          <i class="fas fa-plus-circle"></i>
        </div>
        <h3>Add New Service</h3>
        <p>Create a custom service link</p>
      </a>
    </div>
  </section>

  <!-- System Management Section -->
  <section class="section">
    <div class="section-header">
      <h2><i class="fas fa-server"></i> System Management</h2>
    </div>
    <div class="service-grid">
      <!-- Default System Services -->
      <div class="service-card">
        <a href="https://unifi.ui.com" target="_blank" class="service-link">
          <div class="service-icon">
            <i class="fas fa-wifi"></i>
          </div>
          <h3>Unifi Controller</h3>
          <p>Network Management</p>
        </a>
      </div>

      <div class="service-card">
        <a href="https://vscode.drewwilliams.biz" target="_blank" class="service-link">
          <div class="service-icon">
            <i class="fas fa-code"></i>
          </div>
          <h3>Code Server</h3>
          <p>Web IDE</p>
        </a>
      </div>

      <div class="service-card">
        <a href="https://portainer.drewwilliams.biz" target="_blank" class="service-link">
          <div class="service-icon">
            <i class="fas fa-boxes"></i>
          </div>
          <h3>Portainer</h3>
          <p>Container Management</p>
        </a>
      </div>

      <div class="service-card">
        <a href="https://glances.drewwilliams.biz" target="_blank" class="service-link">
          <div class="service-icon">
            <i class="fas fa-tachometer-alt"></i>
          </div>
          <h3>Glances</h3>
          <p>System Monitoring</p>
        </a>
      </div>

      <!-- Custom System Services -->
      {% for service in system_services %}
        <div class="service-card">
          <!-- Edit button -->
          <a href="{{ url_for('edit_service', service_id=service.id) }}" class="btn-edit-service" title="Edit service">
            <i class="fas fa-cog"></i>
          </a>
          
          <!-- Delete button -->
          <form method="POST" action="{{ url_for('delete_service', service_id=service.id) }}"
                class="delete-service" onsubmit="return confirm('Delete this service?');">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <button type="submit" class="btn-delete-service" title="Delete service">
              <i class="fas fa-trash-alt"></i>
            </button>
          </form>
          
          <!-- Service link wrapper -->
          <a href="{{ service.url }}" target="_blank" class="service-link">
            <div class="service-icon">
              <i class="fas {{ service.icon }}"></i>
            </div>
            <h3>{{ service.name }}</h3>
            <p>{{ service.description }}</p>
          </a>
        </div>
      {% endfor %}

      <!-- Add service card -->
      <a href="{{ url_for('add_service') }}" class="service-card add-card">
        <div class="service-icon">
          <i class="fas fa-plus-circle"></i>
        </div>
        <h3>Add New Service</h3>
        <p>Create a custom service link</p>
      </a>
    </div>
  </section>

  <!-- Weather Section -->
  {% if forecast_data %}
  <section class="dashboard-section" data-aos="fade-up">
    <h2 class="section-title">
      <i class="fas fa-cloud-sun"></i>
      Weather Forecast for {{ city_name }}
    </h2>
    <div class="weather-grid">
      {% for day in forecast_data %}
      <div class="weather-card">
        <h3>{{ day.date_str }}</h3>
        <img src="{{ day.icon_url }}" alt="{{ day.description }}">
        <p class="temp-range">{{ day.temp_min }}°F - {{ day.temp_max }}°F</p>
        <p class="weather-desc">{{ day.description }}</p>
      </div>
      {% endfor %}
    </div>
  </section>
  {% endif %}
</div>

<style>
.dashboard-header {
  margin-bottom: var(--spacing-xl);
}

.welcome-text {
  font-size: 2rem;
  font-weight: 700;
  margin-bottom: var(--spacing-xs);
}

.dashboard-section {
  margin-bottom: var(--spacing-xl);
}

.section-title {
  display: flex;
  align-items: center;
  gap: var(--spacing-sm);
  font-size: 1.5rem;
  margin-bottom: var(--spacing-lg);
}

.service-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax({{ button_width }}px, 1fr));
  gap: var(--spacing-md);
}

.service-card {
  position: relative;
  background-color: white;
  padding: var(--spacing-lg);
  border-radius: var(--radius-lg);
  border: 1px solid #e5e7eb;
  height: {{ button_height }}px;
  transition: all var(--transition-normal);
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
}

.service-link {
  text-decoration: none;
  color: var(--text-dark);
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  width: 100%;
  height: 100%;
}

.service-link h3 {
  margin: var(--spacing-sm) 0;
  color: var(--text-dark);
}

.service-link p {
  color: var(--text-light);
  opacity: 0.9;
}

.btn-edit-service,
.btn-delete-service {
  position: absolute;
  background: none;
  border: none;
  cursor: pointer;
  padding: var(--spacing-xs);
  opacity: 0;
  transition: opacity var(--transition-fast);
  z-index: 2;
}

.btn-edit-service {
  top: var(--spacing-sm);
  left: var(--spacing-sm);
  color: var(--primary);
}

.btn-delete-service {
  top: var(--spacing-sm);
  right: var(--spacing-sm);
  color: var(--danger);
}

.service-card:hover .btn-edit-service,
.service-card:hover .btn-delete-service {
  opacity: 1;
}

.delete-service {
  margin: 0;
  padding: 0;
}

.service-icon {
  font-size: 2rem;
  color: var(--primary);
  margin-bottom: var(--spacing-md);
  flex-shrink: 0;
}

.service-card h3 {
  font-size: 1.25rem;
  margin-bottom: var(--spacing-xs);
  color: var(--text-dark);
  text-align: center;
}

.service-card p {
  font-size: 0.875rem;
  opacity: 0.8;
  text-align: center;
  margin: 0;
}

.weather-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: var(--spacing-md);
  margin-top: var(--spacing-xl);
}

.weather-card {
  background-color: white;
  padding: var(--spacing-lg);
  border-radius: var(--radius-lg);
  border: 1px solid #e5e7eb;
  text-align: center;
  transition: all var(--transition-normal);
}

.weather-card:hover {
  transform: translateY(-3px);
  box-shadow: var(--shadow-lg);
}

.weather-card h3 {
  color: var(--text-dark);
  margin: var(--spacing-sm) 0;
}

.weather-card p {
  color: var(--text-light);
  opacity: 0.9;
}

.weather-icon {
  font-size: 2rem;
  color: var(--primary);
  margin-bottom: var(--spacing-sm);
}

.weather-temp {
  font-size: 1.25rem;
  font-weight: 600;
  color: var(--text-dark);
  margin: var(--spacing-sm) 0;
}

.weather-description {
  color: var(--text-light);
  opacity: 0.9;
}

/* Dark mode adjustments for weather */
body.dark-mode .weather-card {
  background-color: #1f2937;
  border-color: #374151;
}

body.dark-mode .weather-card:hover {
  background-color: #2d3748;
}

body.dark-mode .weather-card h3 {
  color: #e5e7eb;
}

body.dark-mode .weather-card p {
  color: #9ca3af;
  opacity: 1;
}

body.dark-mode .weather-temp {
  color: #e5e7eb;
}

body.dark-mode .weather-description {
  color: #9ca3af;
  opacity: 1;
}

/* Weather icon colors in dark mode */
body.dark-mode .weather-icon {
  color: var(--primary);  /* Keep the icon color consistent with other sections */
}

/* Dark mode adjustments */
body.dark-mode .service-card {
  background-color: #1f2937;
  border-color: #374151;
}

body.dark-mode .service-link {
  color: var(--text-light);
}

body.dark-mode .service-link h3 {
  color: #e5e7eb;
}

body.dark-mode .service-link p {
  color: #9ca3af;
  opacity: 1;
}

body.dark-mode .service-card:hover {
  background-color: #2d3748;
}

/* Responsive adjustments */
@media (max-width: 768px) {
  .service-grid,
  .weather-grid {
    grid-template-columns: 1fr;
  }
  
  .welcome-text {
    font-size: 1.5rem;
  }
}

.add-card {
  border: 2px dashed #e5e7eb;
  background-color: transparent;
}

.add-card:hover {
  border-color: var(--primary);
  background-color: rgba(79, 70, 229, 0.05);
}

.section {
  margin-bottom: var(--spacing-3xl);  /* Increased from default spacing */
  padding: var(--spacing-xl) 0;
}

.section-header {
  margin-bottom: var(--spacing-xl);
}

.section-header h2 {
  display: flex;
  align-items: center;
  gap: var(--spacing-sm);
  font-size: 1.5rem;
  color: var(--text-dark);
}

/* Dark mode support */
body.dark-mode .section-header h2 {
  color: var(--text-light);
}
</style>
{% endblock %}